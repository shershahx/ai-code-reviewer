<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Code Reviewer</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; margin: 2rem; background: #f9f9f9; }
        h2 { color: #333; }
        /* Style the file input to look like a button */
        input[type="file"] { display: none; }
        label.file-upload {
            background: #6c757d; color: white; border: none;
            padding: 10px 15px; border-radius: 4px; font-size: 0.9rem;
            cursor: pointer; margin-right: 10px; display: inline-block;
        }
        label.file-upload:hover { background: #5a6268; }

        textarea { width: 100%; height: 300px; box-sizing: border-box; font-family: monospace; font-size: 1rem; border: 1px solid #ccc; border-radius: 4px; padding: 10px; margin-top: 15px; }
        button { background: #007aff; color: white; border: none; padding: 10px 15px; border-radius: 4px; font-size: 1rem; cursor: pointer; margin-top: 10px; }
        button:hover { background: #0056b3; }
        #review-output { margin-top: 1.5rem; background: #fff; border: 1px solid #eee; border-radius: 4px; padding: 1rem; }
        pre { white-space: pre-wrap; word-wrap: break-word; font-family: monospace; font-size: 1rem; color: #444; }
    </style>
</head>
<body>

    <h2>AI-Powered Code Reviewer</h2>
    <p>Paste your code below or upload a file to get readability feedback from the AI.</p>

    <label for="fileInput" class="file-upload">Upload File (.js, .py, .txt, etc.)</label>
    <input type="file" id="fileInput" accept=".js,.py,.java,.c,.cpp,.txt">
    <span id="fileName">No file selected.</span>

    <textarea id="codeInput" placeholder="Paste your code here, or upload a file..."></textarea>
    <button id="reviewButton">Review Code</button>

    <h3>AI Feedback:</h3>
    <div id="review-output">
        <pre id="feedbackText">Your review will appear here...</pre>
    </div>

    <script>
        // Get references to all the HTML elements
        const reviewButton = document.getElementById('reviewButton');
        const codeInput = document.getElementById('codeInput');
        const feedbackText = document.getElementById('feedbackText');
        const fileInput = document.getElementById('fileInput');
        const fileName = document.getElementById('fileName');

        // *** NEW FILE HANDLING LOGIC ***
        fileInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (!file) {
                return; // No file was selected
            }
            
            // Create a FileReader to read the file content
            const reader = new FileReader();
            
            // Define what happens when the file is loaded
            reader.onload = (e) => {
                const fileContent = e.target.result;
                // Put the file's text content into the textarea
                codeInput.value = fileContent;
                fileName.textContent = file.name; // Show the user what file they uploaded
            };
            
            // Read the file as plain text
            reader.readAsText(file);
        });

        // *** SAME BUTTON CLICK LOGIC AS BEFORE ***
        reviewButton.addEventListener('click', async () => {
            const code = codeInput.value;
            if (!code.trim()) {
                feedbackText.textContent = 'Please paste or upload some code to review.';
                return;
            }

            feedbackText.textContent = 'Analyzing...';

            try {
                // Send the code to our backend API
                const response = await fetch('http://localhost:3001/review', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ code: code })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                feedbackText.textContent = data.review;

            } catch (error) {
                console.error('Error fetching review:', error);
                feedbackText.textContent = 'Error: Could not connect to the review server. Make sure it is running.';
            }
        });
    </script>
</body>
</html>